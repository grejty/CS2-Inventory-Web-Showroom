{% load inventory_tags %}

<div class="skin-item admin-selectable{% if skin.selected %} selected{% endif %}"
     data-tradable="{{ skin.tradable_info.raw }}"
    data-weapon="{{ skin.weapon_type }}"
    data-type="{{ skin.item_type }}"
    data-reserved="{{ skin.is_reserved|yesno:'true,false' }}"
     data-index="{{ skin.form_index }}"
     data-name="{{ skin.name|escape }}"
     data-float="{% if skin.float is not None %}{{ skin.float|floatformat:6 }}{% endif %}"
     data-price="{% if skin.price_eur %}{{ skin.price_eur }}{% endif %}"
     {% if skin.rarity %}data-rarity="{{ skin.rarity }}"{% endif %}
     {% if skin.rarity_color %}style="--rarity-color: {{ skin.rarity_color }};"{% endif %}>
    <div class="skin-header">
        <h3 class="skin-title">{{ skin.name|pipe_breaks }}</h3>
        {% if 'Trade Protected' in skin.tradable_info.raw %}
            <a href="https://help.steampowered.com/en/faqs/view/365F-4BEE-2AE2-7BDD" class="trade-protected-badge" target="_blank" rel="noopener noreferrer" data-tooltip="Trade protected items cannot be modified, consumed, or transferred" aria-label="Trade protected items cannot be modified, consumed, or transferred">
                <span class="badge-icon" aria-hidden="true">
                    <svg viewBox="0 0 24 28" focusable="false" aria-hidden="true">
                        <path d="M12 1.5l8 2.9v6.6c0 5.2-3.5 10.1-8 12-4.5-1.9-8-6.8-8-12V4.4z" fill="#facc15"/>
                        <path d="M12 3.2l6 2.2v5.5c0 4.2-2.8 8.2-6 9.5-3.2-1.3-6-5.3-6-9.5V5.4z" fill="#fde047"/>
                        <path d="M12 1.5l8 2.9v6.6c0 5.2-3.5 10.1-8 12-4.5-1.9-8-6.8-8-12V4.4z" fill="none" stroke="#f59e0b" stroke-width="1.1" stroke-linejoin="round"/>
                        <g transform="translate(0 2) rotate(90 12 12) scale(0.6) translate(4 8.5)">
                            <path d="M10 16H5V21M14 8H19V3M4.583 9.003C5.144 7.616 6.082 6.413 7.293 5.532C8.503 4.651 9.937 4.128 11.43 4.021C12.923 3.913 14.415 4.227 15.738 4.927C17.062 5.626 18.161 6.683 18.914 7.976M19.418 14.997C18.857 16.385 17.918 17.587 16.708 18.468C15.498 19.349 14.065 19.872 12.572 19.979C11.079 20.086 9.586 19.772 8.263 19.073C6.939 18.374 5.839 17.317 5.086 16.024" fill="none" stroke="#92400e" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </g>
                    </svg>
                </span>
            </a>
        {% endif %}
        {% if skin.exterior and skin.exterior != "Not Painted" %}
            <p class="skin-exterior">{{ skin.exterior }}</p>
        {% endif %}
    </div>
    <div class="skin-image">
        {% if skin.stickers or skin.patches %}
            <div class="sticker-stack">
                {% for sticker in skin.stickers %}
                    <a class="sticker-thumb"
                       href="https://steamcommunity.com/market/listings/730/{{ "Sticker | "|add:sticker.name|default:"Sticker"|urlencode }}"
                       target="_blank"
                       rel="noopener noreferrer"
                       data-tooltip="{{ sticker.name|default:"Sticker" }}"
                       aria-label="{{ sticker.name|default:"Sticker" }}">
                        <img src="{{ sticker.icon_url }}" alt="{{ sticker.name|default:"Sticker" }}">
                    </a>
                {% endfor %}
                {% for patch in skin.patches %}
                    <a class="sticker-thumb sticker-thumb--patch"
                       href="https://steamcommunity.com/market/listings/730/{{ "Patch | "|add:patch.name|default:"Patch"|urlencode }}"
                       target="_blank"
                       rel="noopener noreferrer"
                       data-tooltip="{{ patch.name|default:"Patch" }}"
                       aria-label="{{ patch.name|default:"Patch" }}">
                        <img src="{{ patch.icon_url }}" alt="{{ patch.name|default:"Patch" }}">
                    </a>
                {% endfor %}
            </div>
        {% endif %}
        <img src="https://community.cloudflare.steamstatic.com/economy/image/{{ skin.icon_url }}" alt="{{ skin.name }}">
        <input type="checkbox" name="selected_skins" value="{{ skin.form_index }}" {% if skin.selected %}checked{% endif %} class="skin-checkbox" style="display: none;">
    </div>
    <div class="skin-details">
        {% if skin.float is not None %}
            <div class="float-bar-container" style="--float-value: {{ skin.float }};">
                <div class="float-bar" role="presentation">
                    <span class="float-segment segment-fn" data-tooltip="Factory New (0.00 – 0.07)" aria-hidden="true"></span>
                    <span class="float-segment segment-mw" data-tooltip="Minimal Wear (0.07 – 0.15)" aria-hidden="true"></span>
                    <span class="float-segment segment-ft" data-tooltip="Field-Tested (0.15 – 0.38)" aria-hidden="true"></span>
                    <span class="float-segment segment-ww" data-tooltip="Well-Worn (0.38 – 0.45)" aria-hidden="true"></span>
                    <span class="float-segment segment-bs" data-tooltip="Battle-Scarred (0.45 – 1.00)" aria-hidden="true"></span>
                </div>
                <span class="float-indicator" aria-hidden="true"></span>
            </div>
            <div class="float-stats" aria-label="Float and pattern information">
                <span class="float-value" data-tooltip="Float value&#10;controls how much wear the skin has and ranges from 0-1">{{ skin.float|floatformat:6 }}</span>
                <span class="paint-seed" data-tooltip="Paint seed&#10;controls the texture placement of the skin and ranges from 0-1000">
                    {% if skin.pattern_template %}
                        {{ skin.pattern_template }}
                    {% else %}
                        —
                    {% endif %}
                </span>
            </div>
        {% elif skin.item_type == "Agent" and skin.collection %}
            <div class="skin-collection" aria-label="Collection">{{ skin.collection }}</div>
        {% endif %}
    </div>
    <div class="skin-footer">
        <div class="skin-actions">
            {% with info=skin.tradable_info %}
                <div class="meta {% if info %}{{ info.state_class }}{% else %}meta--unlocked{% endif %}"
                     data-lock-state="{% if info and info.lock_state %}{{ info.lock_state }}{% else %}unlocked{% endif %}"
                     {% if info and info.unlock_iso %}data-unlock="{{ info.unlock_iso }}"{% endif %}
                     aria-label="{% if info and info.unlock_text %}{{ info.unlock_text }}{% else %}Tradable{% endif %}">
                    <span class="meta-icon" aria-hidden="true"></span>
                    {% if info and not info.is_tradable and info.unlock_text %}
                        <span class="meta-text">{{ info.unlock_text }}</span>
                    {% endif %}
                </div>
            {% endwith %}
            {% if skin.inspect_link %}
                <a href="{{ skin.inspect_link }}" class="inspect-btn" data-inspect-link="{{ skin.inspect_link }}" aria-label="Inspect in Game" data-tooltip="Inspect in Game">
                    <span class="inspect-icon" aria-hidden="true"></span>
                </a>
            {% endif %}
        </div>
        <div class="skin-price skin-price--editable">
            <label class="skin-price__label" for="price_{{ skin.form_index }}">Price</label>
            <div class="skin-price-input">
                <span class="skin-price-input__currency" aria-hidden="true">€</span>
                <input type="number"
                       step="0.01"
                       min="0"
                       inputmode="decimal"
                       id="price_{{ skin.form_index }}"
                       name="price_{{ skin.form_index }}"
                       value="{% if skin.price_eur %}{{ skin.price_eur|floatformat:"-2" }}{% endif %}"
                       placeholder="0.00"
                       aria-label="Enter price in euros for {{ skin.name }}">
            </div>
        </div>
    </div>
    <div class="skin-note">
        <label class="skin-note__label" for="note_{{ skin.form_index }}">Admin note</label>
        <textarea id="note_{{ skin.form_index }}"
                  name="note_{{ skin.form_index }}"
                  rows="2"
                  maxlength="500"
                  placeholder="Add a private note">{{ skin.note|default_if_none:'' }}</textarea>
    </div>
</div>
